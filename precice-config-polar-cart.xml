<?xml version="1.0"?>

<precice-configuration>

    <log>
	<!--
	<sink type="stream" output="stdout"  filter= "(%Severity% > debug) or (%Severity% >= trace and %Module% contains SolverInterfaceImpl)"  enabled="true" />
	-->
	<sink type="stream" output="stdout" filter="%Severity% > debug" enabled="true"/>
    </log>
  
  <solver-interface dimensions="2">
    
    <data:scalar name="value"/>
    <data:vector name="flux"/>

    <mesh name="core_mesh">
       <use-data name="flux"/>
       <use-data name="value"/>
    </mesh>

    <mesh name="edge_cartesian">
       <use-data name="value"/>
    </mesh>
    
    <mesh name="edge_polar">
       <use-data name="flux"/>
    </mesh>
    
    <participant name="Core">
      <use-mesh name="core_mesh" provide="yes"/>
      <use-mesh name="edge_cartesian" from="Edge"/>
      <use-mesh name="edge_polar" from="Edge"/>
      <write-data name="value" mesh="core_mesh"/>
      <read-data name="flux" mesh="core_mesh"/>
      <mapping:rbf-thin-plate-splines direction="write" from="core_mesh" to="edge_cartesian" constraint="consistent"/>
      <mapping:nearest-neighbor direction="read" from="edge_polar" to="core_mesh" constraint="consistent"/>
    </participant>
    
    <participant name="Edge">		
      <use-mesh name="edge_cartesian" provide="yes"/>
      <use-mesh name="edge_polar" provide="yes"/>
      <read-data name="value" mesh="edge_cartesian"/>
      <write-data name="flux" mesh="edge_polar"/>
    </participant>

    <m2n:sockets from="Core" to="Edge" network="ib0"/>

      <!--
    <coupling-scheme:serial-implicit>
       <participants first="Core" second="Edge"/>
       <max-time value="0.5"/>
       <time-window-size value="0.0002"/>
       <max-iterations value="30"/>
       <exchange data="value" mesh="edge_cartesian" from="Core" to="Edge"/>
       <exchange data="flux" mesh="edge_polar" from="Edge" to="Core"/>
       <relative-convergence-measure data="value" mesh="edge_cartesian" limit="1e-2" strict="true"/>
       <relative-convergence-measure data="flux" mesh="edge_polar" limit="1e-2" strict="true"/>
       <acceleration:constant>
	 <relaxation value="0.5"/>
       </acceleration:constant>
       <acceleration:IQN-ILS>
    	 <data name="value" mesh="edge_cartesian"/>
         <initial-relaxation value="0.1"/>
         <max-used-iterations value="30"/>
         <time-windows-reused value="20"/>
         <filter type="QR2" limit="1e-2"/>
       </acceleration:IQN-ILS>
    </coupling-scheme:serial-implicit>
    -->

    <coupling-scheme:serial-explicit>
       <participants first="Core" second="Edge"/>
       <max-time value="1.0"/>
       <time-window-size value="1e-4"/>
       <exchange data="value" mesh="edge_cartesian" from="Core" to="Edge"/>
       <exchange data="flux" mesh="edge_polar" from="Edge" to="Core"/>
    </coupling-scheme:serial-explicit>

  </solver-interface>
</precice-configuration>
